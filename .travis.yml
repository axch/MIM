
language: python
python:
  - "2.7"

sudo: required

branches:
  only:

before_install: 
  - sudo apt-get install gfortran
  - sudo apt-get install valgrind
  - sudo apt-get install libopenmpi-dev
  - sudo apt-get install openmpi-bin
  - pip install scipy
  - pip install sphinx
  - pip install sphinx_rtd_theme
  - pip install recommonmark
  - pip install matplotlib
  - pip install pytest-cov
  - pip install codecov
  - cd lib/hypre/src
  - ./configure
  - make install
  - cd ../../..

install: 
  - pip install -e .

script:
  - mpif90 -Werror aronnax.f90 -cpp
  - pytest --cov=aronnax
  - codecov
  - python test/periodic_BC_Hypre.py
  - codecov

after_success:
  - cd reproductions
  - python run_davis_et_al_2014.py
  - python plot_Davis_et_al_2014.py
  - cd ../benchmarks
  - python benchmark.py
  - cd ../test
  - python physics_tests.py
  - cd ../docs
  - make html
  - cd _build/html


deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GH_token # Set in travis-ci.org dashboard
  on:
    branch: master
